# cut release; create branch and do it
p4 branch stringtemplate-2.3
#//depot/code/stringtemplate/java/main/... //depot/code/stringtemplate/java/release-2.3/...
p4 integrate -b stringtemplate-2.3
p4 submit

cd ~/antlr/code/stringtemplate/java/release-2.3

# build antlr generated files
pushd src/org/antlr/stringtemplate/language
java antlr.Tool group.g
java antlr.Tool template.g 
java antlr.Tool action.g 
java antlr.Tool eval.g
java antlr.Tool interface.g
java antlr.Tool angle.bracket.template.g
popd

# compile
pushd src
javac -source jsr14 -classpath .:/usr/local/lib/antlr-2.7.7.jar:/usr/local/lib/junit.jar org/antlr/stringtemplate/*.java org/antlr/stringtemplate/*/*.java

# build a jar
mkdir ../lib
jar cvf ../lib/stringtemplate.jar org/antlr/stringtemplate/*.class org/antlr/stringtemplate/*/*.class
cp /usr/local/lib/antlr-2.7.7.jar ../lib

# remove .class files
find org -name '*.class' -exec rm {} \;
popd

find . -name '*~' -exec rm {} \;

cd ..
cp -r release-3.0 /tmp/stringtemplate-3.0
pushd /tmp/stringtemplate-3.0/
chmod -R +w *

find . -name '*.iml' -exec rm {} \;

# make tarball (next time name release stringtemplate-2.3b7 dir)
pushd /tmp
tar cvfz stringtemplate-3.0.tar.gz stringtemplate-3.0

# push
scp stringtemplate-3.0.tar.gz parrt@antlr.org:/usr/local/site/magenta/web/download

# push bugs
pushd ~/antlr/code/stringtemplate/support
scp bugs.tml parrt@antlr.org:/var/data/magenta/resources    

# push api
scp -r /tmp/stdoc/api parrt@antlr.org:/var/data/magenta/resources/doc
